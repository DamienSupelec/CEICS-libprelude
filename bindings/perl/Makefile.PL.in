use Config;
use ExtUtils::MakeMaker;
use File::Copy;
use Cwd "abs_path";

if ( abs_path("@top_srcdir@") ne abs_path("@top_builddir@") ) {
    foreach my $filename ( qw/Prelude.c Prelude.pm/ ) {
	my $src = "@top_srcdir@/bindings/perl/$filename";
	my $dst = "@top_builddir@/bindings/perl/$filename";
	copy($src, $dst) if ( ! -e $dst );
    }
}

my %attributs = (NAME => 'Prelude',
		 INC => '-I@top_builddir@/src/include -I@top_srcdir@/src/include',
		 LIBS => [ "@libprelude_libs@ -L@top_builddir@/src/.libs -lprelude" ],
		 LDDLFLAGS => "@PTHREAD_CFLAGS@ $Config{lddlflags}");

if  (-w $Config{"sitelib"}) {
    $attributs{"INSTALLDIRS"} = "site";
} else {
    $attributs{"PREFIX"} = "@prefix@";
}

WriteMakefile(%attributs);
