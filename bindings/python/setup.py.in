import sys, os

from distutils.sysconfig import get_python_lib
from distutils.core import setup, Extension

def split_args(s):
    import re
    return re.split("\s+", s.strip())

if sys.argv[1] == "install" and not os.access(get_python_lib(), os.W_OK):
    sys.argv.extend(["--prefix", "@prefix@"])
    

setup(name="prelude",
      package_dir={'prelude': '@top_srcdir@/bindings/python'},
      py_modules=["prelude"],
      ext_modules=[Extension("_prelude",
                             ["@top_srcdir@/bindings/python/_prelude.c"],
                             extra_compile_args=["-I@top_srcdir@/src/include"],
                             extra_link_args=split_args("@PTHREAD_CFLAGS@ @libprelude_libs@ "
                                                        "-L@top_builddir@/src/.libs -lprelude"))])
